<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <title>Gallery</title>
    <link rel="stylesheet" type="text/css" href="{% static 'images/style.css' %}">
</head>
<body>
    {% if user.is_authenticated %}
        <form method="post" enctype="multipart/form-data" action="{% url 'images:add_image' %}">
            {% csrf_token %}
            {{ form.image }}<br><br>
            {{ form.signature }}<br><br>
            <input type="submit" value="Добавить"><br><br>
        </form>
    {% else %}
        <a href="{% url 'authorization:login' %}">Авторизоваться</a><br><br>
    {% endif %}

    {% if user.is_authenticated %}
        <b>{{ user.username }}</b> (<a href="/accounts/logout/">выйти</a>)<br><br>
    {% endif %}

    <div class="wrapper">
    {% for image in images %}
        <div>
            <a href="{{image.image.url}}" target="_blank"><img src="{{ image.image.url }}" class="an_image"></a><br>
            <b>{{ image.signature }}</b><br>
            Автор: <b>{{ image.user.username }}</b><br>
            {% if user.is_authenticated %}
                {% if user in image.likes.all %}
                    <a href="{% url 'images:like' image.id %}" class="button"><img src="{% static 'images/icons/like_set.png' %}"></a> {{ image.likes.count }}
                {% else %}
                    <a href="{% url 'images:like' image.id %}" class="button"><img src="{% static 'images/icons/like_unset.png' %}"></a> {{ image.likes.count }}
                {% endif %}
            {% else %}
                <img src="{% static 'images/icons/like_unset.png' %}"> {{ image.likes.count }}
            {% endif %}
            | <a href="{% url 'comments:index' image.id %}"><img src="{% static 'images/icons/comment.png' %}"></a> 0
        </div>
    {% endfor %}
    </div><br><br>

    <div class="paginator">
        {% if page_obj.has_previous %}
            <a href="?page=1">|<<|</a>
            <a href="?page={{ page_obj.previous_page_number }}"><|</a>
        {% endif %}

        Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">|></a>
            <a href="?page={{ page_obj.paginator.num_pages }}">|>>|</a>
        {% endif %}
    </div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    // AJAX CALL
    $('.likin').click(function(){
        $.ajax({
                 type: "GET",
                 url: "{% url 'images:like' 1 %}",
                 data: {'content_id': $(this).attr('name'),'operation':'like_submit','csrfmiddlewaretoken': '{{ csrf_token }}'},
                 dataType: "json",
                 success: function(response) {
            });
      })
</script>

</body>
</html>
